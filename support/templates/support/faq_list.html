{% extends "support/base.html" %}
{% load static %}

{% block content %}
<!-- Premium Typography -->
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<div class="faq-page-wrapper">

    <!-- Hero Section -->
    <div class="faq-hero">
        <div class="hero-glow-1"></div>
        <div class="hero-glow-2"></div>
        <div class="container relative-z text-center">
            <h1 class="hero-title animate-down">Nasıl yardımcı olabiliriz?</h1>
            <p class="hero-subtitle animate-down delay-1">Sıkça sorulan sorulara hızlıca ulaşın veya aradığınızı anında
                bulun.</p>

            <!-- Modern Search Box -->
            <div class="hero-search-container animate-up delay-2">
                <i class="fas fa-search search-icon-hero"></i>
                <input type="text" id="faqSearchInput" class="hero-search-input"
                    placeholder="Bir soru arayın... (Örn: Burs, Kayıt, Transkript)">
            </div>
        </div>
    </div>

    <div class="container main-content">

        <!-- Filter Bar -->
        <div class="filter-bar animate-up delay-3">
            <button class="filter-btn active" data-filter="all">Tümü</button>
            <button class="filter-btn" data-filter="akademik">Akademik</button>
            <button class="filter-btn" data-filter="teknik">Teknik</button>
            <button class="filter-btn" data-filter="mali">Mali İşler</button>
            <button class="filter-btn" data-filter="ogrenci">Öğrenci İşleri</button>
        </div>

        <!-- Popular Topics Grid -->
        <div class="row mb-5 animate-up delay-4">
            <div class="col-12 mb-4">
                <h3 class="section-heading"><i class="fas fa-fire text-warning"></i> Popüler Konular</h3>
            </div>

            <div class="col-md-4 mb-4">
                <div class="topic-card" onclick="triggerSearch('Kayıt')">
                    <div class="topic-icon bg-blue-light">
                        <i class="fas fa-user-graduate text-blue"></i>
                    </div>
                    <div class="topic-info">
                        <h5>Kayıt İşlemleri</h5>
                        <p>Ders kaydı ve yenileme</p>
                    </div>
                    <i class="fas fa-arrow-right topic-arrow"></i>
                </div>
            </div>

            <div class="col-md-4 mb-4">
                <div class="topic-card" onclick="triggerSearch('Burs')">
                    <div class="topic-icon bg-green-light">
                        <i class="fas fa-money-bill-wave text-green"></i>
                    </div>
                    <div class="topic-info">
                        <h5>Burs & Ücretler</h5>
                        <p>Ödeme planları ve burslar</p>
                    </div>
                    <i class="fas fa-arrow-right topic-arrow"></i>
                </div>
            </div>

            <div class="col-md-4 mb-4">
                <div class="topic-card" onclick="triggerSearch('Sınav')">
                    <div class="topic-icon bg-purple-light">
                        <i class="fas fa-pen-alt text-purple"></i>
                    </div>
                    <div class="topic-info">
                        <h5>Sınavlar</h5>
                        <p>Takvim ve sonuçlar</p>
                    </div>
                    <i class="fas fa-arrow-right topic-arrow"></i>
                </div>
            </div>
        </div>

        <!-- FAQ List -->
        <div class="faq-list-section animate-up delay-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="section-heading">Tüm Sorular</h3>
                <span class="badge-count">{{ faqs|length }} Soru</span>
            </div>

            <div class="faq-grid" id="faqGrid">
                {% if faqs %}
                {% for faq in faqs %}
                <div class="faq-card" data-category="{{ faq.category.name|lower|default:'all' }}"
                    data-keywords="{{ faq.question|striptags|lower }} {{ faq.answer|striptags|lower }}">
                    <div class="faq-header" onclick="toggleFaq(this)">
                        <h5 class="faq-title">{{ faq.question }}</h5>
                        <span class="faq-toggle-icon"><i class="fas fa-plus"></i></span>
                    </div>
                    <div class="faq-body">
                        <div class="faq-content">
                            {{ faq.answer|linebreaks }}
                            <div class="faq-actions mt-3">
                                <div class="tag-badge">
                                    <i class="fas fa-tag"></i> {{ faq.category.name|default:"Genel" }}
                                </div>
                                <button class="btn-useful" onclick="markUseful(this, {{ faq.id }})">
                                    <i class="far fa-thumbs-up"></i> Yararlı
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <div class="empty-state text-center py-5">
                    <div class="empty-icon-large mb-3"><i class="fas fa-search"></i></div>
                    <h3>Sonuç Bulunamadı</h3>
                    <p class="text-muted">Aramanızla eşleşen bir soru bulunamadı.</p>
                </div>
                {% endif %}
            </div>

            <!-- Client-side No Results Message (Hidden by default) -->
            <div id="js-no-results" class="empty-state text-center py-5" style="display: none;">
                <div class="empty-icon-large mb-3"><i class="fas fa-search"></i></div>
                <h3>Eşleşen sonuç bulunamadı</h3>
                <p class="text-muted">Lütfen farklı anahtar kelimeler deneyin.</p>
            </div>
        </div>

        <!-- Contact CTA -->
        <div class="contact-cta animate-up delay-6">
            <div class="cta-content">
                <h2>Cevabınızı bulamadınız mı?</h2>
                <p>Destek ekibimiz size yardımcı olmak için burada.</p>
            </div>
            <div class="cta-buttons">
                <a href="{% url 'support:create_ticket' %}" class="btn-cta primary">
                    <i class="fas fa-paper-plane"></i> Talep Oluştur
                </a>
                <a href="{% url 'contact:contact' %}" class="btn-cta outline">
                    <i class="fas fa-comment-alt"></i> İletişime Geç
                </a>
            </div>
        </div>

    </div>
</div>

<style>
    :root {
        --f-primary: #0f172a;
        --f-secondary: #3b82f6;
        --f-bg: #f8fafc;
        --f-card: #ffffff;
        --f-text: #334155;
        --f-text-light: #64748b;
        --f-gradient: linear-gradient(135deg, #092442 0%, #1d61a9 100%);
    }

    .faq-page-wrapper {
        font-family: 'Outfit', sans-serif;
        background-color: var(--f-bg);
        min-height: 100vh;
        padding-bottom: 5rem;
    }

    /* Hero */
    .faq-hero {
        background: var(--f-gradient);
        padding: 5rem 0 8rem;
        position: relative;
        overflow: hidden;
        color: white;
        margin-top: -85px;
        /* Adjust for navbar overlap if needed */
        padding-top: 150px;
        margin-top: -100px;
    }


    .hero-glow-1,
    .hero-glow-2 {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.2;
    }

    .hero-glow-1 {
        width: 400px;
        height: 400px;
        background: #60a5fa;
        top: -100px;
        left: -100px;
    }

    .hero-glow-2 {
        width: 300px;
        height: 300px;
        background: #fda4af;
        bottom: -50px;
        right: -50px;
    }

    .relative-z {
        position: relative;
        z-index: 2;
    }

    .hero-title {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: #f0fdf4;
    }

    .hero-subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
        margin-bottom: 3rem;
        font-weight: 300;
    }

    /* Search Box */
    .hero-search-container {
        position: relative;
        max-width: 700px;
        margin: 0 auto;
        background: white;
        border-radius: 50px;
        padding: 0.5rem;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
    }

    .search-icon-hero {
        font-size: 1.2rem;
        color: var(--f-text-light);
        margin-left: 1.5rem;
    }

    .hero-search-input {
        border: none;
        background: transparent;
        width: 100%;
        padding: 1rem 1.5rem;
        font-size: 1.1rem;
        color: var(--f-text);
        outline: none;
        font-family: 'Outfit', sans-serif;
    }

    /* Main Content */
    .main-content {
        margin-top: -4rem;
        position: relative;
        z-index: 5;
    }

    /* Filter Bar */
    .filter-bar {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
        margin-bottom: 4rem;
    }

    .filter-btn {
        background: white;
        border: 1px solid rgba(0, 0, 0, 0.05);
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        color: var(--f-text);
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
    }

    .filter-btn:hover,
    .filter-btn.active {
        background: var(--f-secondary);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
    }

    /* Topic Cards */
    .section-heading {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--f-primary);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .topic-card {
        background: white;
        border-radius: 20px;
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1.2rem;
        cursor: pointer;
        transition: 0.3s;
        border: 1px solid rgba(0, 0, 0, 0.03);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02);
    }

    .topic-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.08);
    }

    .topic-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }

    .bg-blue-light {
        background: #eff6ff;
    }

    .text-blue {
        color: #3b82f6;
    }

    .bg-green-light {
        background: #f0fdf4;
    }

    .text-green {
        color: #22c55e;
    }

    .bg-purple-light {
        background: #faf5ff;
    }

    .text-purple {
        color: #a855f7;
    }

    .topic-info h5 {
        margin: 0;
        font-weight: 600;
        color: var(--f-primary);
        font-size: 1.1rem;
    }

    .topic-info p {
        margin: 0;
        font-size: 0.9rem;
        color: var(--f-text-light);
    }

    .topic-arrow {
        margin-left: auto;
        color: var(--f-text-light);
        opacity: 0;
        transition: 0.3s;
    }

    .topic-card:hover .topic-arrow {
        opacity: 1;
        transform: translateX(5px);
    }

    /* FAQ List */
    .badge-count {
        background: #e2e8f0;
        color: var(--f-text);
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .faq-card {
        background: white;
        border-radius: 16px;
        margin-bottom: 1rem;
        overflow: hidden;
        border: 1px solid rgba(0, 0, 0, 0.03);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
        transition: 0.3s;
    }

    .faq-card.active {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        border-color: rgba(59, 130, 246, 0.2);
    }

    .faq-header {
        padding: 1.5rem;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        user-select: none;
    }

    .faq-title {
        margin: 0;
        font-weight: 600;
        color: var(--f-primary);
        font-size: 1.1rem;
        flex: 1;
        padding-right: 1rem;
    }

    .faq-toggle-icon {
        width: 32px;
        height: 32px;
        background: #f1f5f9;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--f-secondary);
        transition: 0.3s;
    }

    .faq-card.active .faq-toggle-icon {
        background: var(--f-secondary);
        color: white;
        transform: rotate(45deg);
    }

    .faq-body {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s cubic-bezier(0, 1, 0, 1);
        background: #f8fafc;
    }

    .faq-card.active .faq-body {
        max-height: 500px;
        transition: max-height 0.4s ease-in-out;
    }

    .faq-content {
        padding: 1.5rem;
        border-top: 1px solid rgba(0, 0, 0, 0.03);
        color: var(--f-text);
        line-height: 1.6;
    }

    .faq-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .tag-badge {
        font-size: 0.85rem;
        color: var(--f-text-light);
        background: #e2e8f0;
        padding: 0.2rem 0.6rem;
        border-radius: 6px;
    }

    .btn-useful {
        background: transparent;
        border: 1px solid #e2e8f0;
        padding: 0.3rem 0.8rem;
        border-radius: 6px;
        font-size: 0.85rem;
        color: var(--f-text-light);
        cursor: pointer;
        transition: 0.3s;
    }

    .btn-useful:hover,
    .btn-useful.liked {
        border-color: var(--f-secondary);
        color: var(--f-secondary);
    }

    /* CTA Section */
    .contact-cta {
        margin-top: 4rem;
        background: white;
        border-radius: 20px;
        padding: 3rem;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .cta-content h2 {
        color: var(--f-primary);
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .cta-content p {
        color: var(--f-text-light);
        margin-bottom: 2rem;
    }

    .cta-buttons {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        justify-content: center;
    }

    .btn-cta {
        padding: 0.9rem 2rem;
        border-radius: 12px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: 0.3s;
    }

    .btn-cta.primary {
        background: var(--f-secondary);
        color: white;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }

    .btn-cta.primary:hover {
        transform: translateY(-3px);
    }

    .btn-cta.outline {
        border: 2px solid var(--f-secondary);
        color: var(--f-secondary);
    }

    .btn-cta.outline:hover {
        background: var(--f-secondary);
        color: white;
    }

    /* Animations */
    .animate-down {
        animation: fadeInDown 0.8s ease forwards;
        opacity: 0;
        transform: translateY(-20px);
    }

    .animate-up {
        animation: fadeInUp 0.8s ease forwards;
        opacity: 0;
        transform: translateY(20px);
    }

    .delay-1 {
        animation-delay: 0.1s;
    }

    .delay-2 {
        animation-delay: 0.2s;
    }

    .delay-3 {
        animation-delay: 0.3s;
    }

    .delay-4 {
        animation-delay: 0.4s;
    }

    .delay-5 {
        animation-delay: 0.5s;
    }

    .delay-6 {
        animation-delay: 0.6s;
    }

    @keyframes fadeInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeInDown {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Media Queries */
    @media (max-width: 768px) {
        .hero-title {
            font-size: 2rem;
        }

        .hero-search-container {
            margin: 0 1rem;
        }

        .filter-bar {
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
    }
</style>

<script>
    function toggleFaq(header) {
        const card = header.parentElement;
        const body = card.querySelector('.faq-body');
        const isActive = card.classList.contains('active');

        // Close all others
        document.querySelectorAll('.faq-card.active').forEach(c => {
            if (c !== card) {
                c.classList.remove('active');
            }
        });

        if (isActive) {
            card.classList.remove('active');
        } else {
            card.classList.add('active');
        }
    }

    function triggerSearch(term) {
        const input = document.getElementById('faqSearchInput');
        input.value = term;
        input.dispatchEvent(new Event('input'));

        // Scroll to results
        document.querySelector('.faq-list-section').scrollIntoView({ behavior: 'smooth' });
    }

    function markUseful(btn, id) {
        btn.classList.toggle('liked');
        const icon = btn.querySelector('i');
        if (btn.classList.contains('liked')) {
            btn.innerHTML = '<i class="fas fa-thumbs-up"></i> Teşekkürler';
        } else {
            btn.innerHTML = '<i class="far fa-thumbs-up"></i> Yararlı';
        }
    }

    // Search and Filter Logic
    document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('faqSearchInput');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const faqCards = document.querySelectorAll('.faq-card');
        const noResultsMsg = document.getElementById('js-no-results');

        // Filter Buttons
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Toggle active state
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                filterContent();
            });
        });

        // Search Input
        searchInput.addEventListener('input', filterContent);

        function filterContent() {
            // Enhanced Turkish character handling
            const searchTerm = searchInput.value.toLocaleLowerCase('tr');

            const activeCategory = document.querySelector('.filter-btn.active').getAttribute('data-filter');
            let visibleCount = 0;

            faqCards.forEach(card => {
                const keywords = card.getAttribute('data-keywords'); // Assuming backend provides lowercase
                const category = card.getAttribute('data-category');

                // Check Category
                let catMatch = (activeCategory === 'all');
                if (!catMatch) {
                    if (activeCategory === 'akademik' && category.includes('akademik')) catMatch = true;
                    else if (activeCategory === 'teknik' && category.includes('teknik')) catMatch = true;
                    else if (activeCategory === 'mali' && (category.includes('mali') || category.includes('ücret'))) catMatch = true;
                    else if (activeCategory === 'ogrenci' && (category.includes('öğrenci') || category.includes('kayıt'))) catMatch = true;
                }

                // Check Search
                // Simple includes check is often sufficient if both sides are lowercased correctly
                let searchMatch = !searchTerm || keywords.includes(searchTerm);

                if (catMatch && searchMatch) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            // Toggle No Results Message
            if (noResultsMsg) {
                if (visibleCount === 0 && faqCards.length > 0) {
                    noResultsMsg.style.display = 'block';
                } else {
                    noResultsMsg.style.display = 'none';
                }
            }
        }
    });
</script>
{% endblock %}